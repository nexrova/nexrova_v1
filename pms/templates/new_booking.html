{% extends "base.html" %}

{% block title %}New Booking - {{ hotel.name }}{% endblock %}
{% block page_title %}Create New Booking{% endblock %}

{% block content %}
<div class="card">
    <div class="mb-4">
        <a href="/bookings" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Bookings
        </a>
    </div>

    <form method="POST" class="booking-form">
        <!-- Guest Information -->
        <div class="mb-6">
            <h3><i class="fas fa-user"></i> Guest Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                <div class="form-group">
                    <label for="guest_name">Full Name <span>*</span></label>
                    <input type="text" id="guest_name" name="guest_name" required placeholder="Enter guest name">
                </div>
                <div class="form-group">
                    <label for="guest_email">Email <span>*</span></label>
                    <input type="email" id="guest_email" name="guest_email" required placeholder="guest@example.com">
                </div>
                <div class="form-group">
                    <label for="guest_phone">Phone Number <span>*</span></label>
                    <input type="tel" id="guest_phone" name="guest_phone" required placeholder="+91-XXXXXXXXXX">
                </div>
                <div class="form-group">
                    <label for="id_proof">ID Proof</label>
                    <input type="text" id="id_proof" name="id_proof" placeholder="Aadhaar / Passport / Driving License">
                </div>
            </div>
        </div>

        <!-- Booking Details -->
        <div class="mb-6">
            <h3><i class="fas fa-calendar"></i> Booking Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                <div class="form-group">
                    <label for="room_id">Select Room <span>*</span></label>
                    <select id="room_id" name="room_id" required onchange="calculatePrice()">
                        <option value="">Choose a room...</option>
                        {% for room in rooms %}
                            <option value="{{ room.room_id }}" data-price="{{ room.base_price }}">
                                Room {{ room.room_number }} - {{ room.room_type }} (₹{{ room.base_price }})
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="check_in">Check-in Date <span>*</span></label>
                    <input type="date" id="check_in" name="check_in" required onchange="calculatePrice()">
                </div>
                <div class="form-group">
                    <label for="check_out">Check-out Date <span>*</span></label>
                    <input type="date" id="check_out" name="check_out" required onchange="calculatePrice()">
                </div>
            </div>

            <!-- Price Summary -->
            <div id="priceSummary" style="display: none;">
                <div>
                    <span>Number of Nights:</span> <strong id="nights">0</strong>
                </div>
                <div>
                    <span>Rate per Night:</span> <strong id="rate">₹0</strong>
                </div>
                <div>
                    <span>Total Amount:</span> <strong id="total">₹0</strong>
                </div>
            </div>
        </div>

        <!-- Form Buttons -->
        <div class="flex gap-4">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-check"></i> Create Booking
            </button>
            <a href="/bookings" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
function calculatePrice() {
    const roomSelect = document.getElementById('room_id');
    const checkIn = document.getElementById('check_in').value;
    const checkOut = document.getElementById('check_out').value;

    if (roomSelect.value && checkIn && checkOut) {
        const price = parseFloat(roomSelect.options[roomSelect.selectedIndex].dataset.price);
        const checkInDate = new Date(checkIn);
        const checkOutDate = new Date(checkOut);
        const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));

        if (nights > 0) {
            const total = price * nights;
            document.getElementById('nights').textContent = nights;
            document.getElementById('rate').textContent = '₹' + price.toFixed(2);
            document.getElementById('total').textContent = '₹' + total.toFixed(2);
            document.getElementById('priceSummary').style.display = 'block';
        }
    }
}

// Set minimum date to today
const today = new Date().toISOString().split('T')[0];
document.getElementById('check_in').min = today;
document.getElementById('check_out').min = today;
</script>
{% endblock %}
